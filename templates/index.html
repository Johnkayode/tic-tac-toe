<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tic-Tac-Toe</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js" integrity="sha384-c79GN5VsunZvi+Q/WObgk2in0CbZsHnjEqvFxC5DxHn9lTfNce2WW6h2pH6u/kF+" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/js/all.min.js" ></script>
</head>

<body>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Mono&display=swap');

        body {
            font-family: 'Space Mono', monospace;
            background: #222222;
            padding: auto;
        }

        .page{
            margin: 50px auto;
        }

        #copyGameUrl {
            background-color: #fff;
            padding: 10px 12px;
            border-radius: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #copyGameUrl .fa-copy {
            cursor: pointer;
        }

        #board {
            width: 450px;
        }
        #board button {
            height: 150px;
            width: 150px;
            float: left;
            font-size: 2.5rem;
            cursor: pointer;
        }
        #board button:focus{
            border: none;
            outline: none;
        }

        .page {
            max-width: 400px;
        }

        #join h2,
        #start h2 {
            text-align: center;
            color: #fff;
        }

        #join input,
        #start input {
            width: 100%;
            padding: 8px;
            box-sizing: border-box;
            margin-bottom: 16px;
            border-radius: 4px;
            outline: none;
            text-decoration: none;
            border: 2px solid transparent;
            font-family: 'Space Mono', monospace;
        }

        #join input:focus-within,
        #start input:focus-within{
            outline: none;
            border: 2px solid green;
        }

        #join button,
        #start button {
            background-color: #4caf50;
            color: #fff;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-family: 'Space Mono', monospace;
        }

        #join button:hover,
        #start button:hover {
            background-color: #45a049;
        }

        #share p{
            color: #fff;
        }

        
    </style>

    <section id="start" class="page">
        <h2>Tic-Tac-Toe</h2> 
        <input type="text" id="username" placeholder="Enter username" required>
        <button id="startGame">Start Game ></button>  

    </section>

    <section id="share" class="page" hidden>
        <p>Copy and share URL to other player to join game</p>
        <div id="copyGameUrl">
            <span id="copyUrl"></span>
            <i class="fa-regular fa-copy" id="copy"></i>
        </div>
    </section>

    <section id="join" class="page" hidden>
        <h2>Tic-Tac-Toe</h2> 
        <input type="text" id="gameCode" hidden>
        <input type="text" id="username_2" placeholder="Enter username" required>
        <button id="joinGame">Join Game</button>  
    </section>

    <section id="board" class="page" hidden>
        <button id="r1c1">X</button><button id="r1c2"></button><button id="r1c3"></button>
        <button id="r2c1">O</button><button id="r2c2">X</button><button id="r2c3">O</button>
        <button id="r3c1">X</button><button id="r3c2">O</button><button id="r3c3">O</button>
    </section>
  
    <script>
        const url = "http://localhost:3000"
        const socket = io(url);
        
        let gameId = "";

        function createGame(username){
            socket.emit('createGame', { username: username } );
        }

        function joinGame(username, gameId){
            socket.emit('joinGame', { username: username, gameId: gameId })
        }

        socket.on('gameCreated', (data) => {
            gameId = data.gameId;
            let _url = `${url}?id=${gameId}`;
            $('.page').hide()
            $('#share').show()
            $('#copyUrl').text(_url);
            
            console.log(`Game created with code: ${gameId}`);
        });

        socket.on('gameJoined', (data) => {
            username = data.username
            gameId = data.gameId;

            $('.page').hide()
            $('#board').show()
            console.log(`${username} joined game`);
        });

        socket.on('invalidGame', () => {
            console.log('Invalid game code');
        });

        socket.on('moveMade', (data) => {
            // Handle the move on the Tic-Tac-Toe board
            console.log(`Move made: ${JSON.stringify(data)}`);
        });


        $(document).ready(function() {
            function getQueryParam(name) {
                const urlParams = new URLSearchParams(window.location.search);
                return urlParams.get(name);
            }

            function PageLoad() {
                const gameId = getQueryParam('id');
                // Check if the query parameter is present and not null
                if (gameId !== null) {
                    $('.page').hide()
                    $('#join').show()
                    $('#gameCode').val(gameId);
                } else {
                    $('.page').hide()
                    $('#start').show()
                }
            }

            PageLoad()

            $('#startGame').on('click', () => {
                let username = document.getElementById('username').value;
                createGame(username)
            });

            $('#joinGame').on('click', () => {
                let username = $('#username_2').val();
                let gameId = $('#gameCode').val();
                joinGame(username, gameId)
            });


            $('#board').on('click', 'button', (event) => {
                const cellId = this.id;
                socket.emit('makeMove', { gameId, cellId });
                console.log(cellId);
            });

            $('#copy').on('click', (event) => {
                let url = $('#copyUrl').text();
                navigator.clipboard.writeText(url);
               
            });

            
        });



        
    </script>
</body>
</html>